### Пример автоматического запуска python функции с помощью AirFlow

В скрипте AirFlow с помощью PythonOperator вызывает функцию запроса текущих координат МКС get_mks_data() с привязкой к DAG'у (раз в 30 минут) и записывает их в log.

1) Создать виртуальную машину (Compute Cloud) с AirFlow
2) При создании группа безопасности должна иметь следующие настройки:

Исходящий трафик:
| Протокол | Диапазон портов | Тип назначения       | Назначение    | Описание |
|----------|-----------------|----------------------|---------------|----------|
| Any	   | 0-65535	     |	Группа безопасности |	Self	    |	—      |
| TCP	   | 443			 |	CIDR				|	0.0.0.0/0 	|   —      |
| Any	   | 0-65535		 |	CIDR				|	0.0.0.0/0   |	—      |

Входящий трафик:
| Протокол | Диапазон портов |	Тип источника       | Источник      | Описание |
|----------|-----------------|----------------------|---------------|----------|
| Any	   | 0-65535		 |	Группа безопасности	|	Self	    |	—      |
| TCP	   | 22				 |  CIDR				|	0.0.0.0/0   | 	—      |
| ICMP	   | —				 |  CIDR				|	0.0.0.0/0   | 	—      |
| TCP	   | 80				 |  CIDR				|	0.0.0.0/0   | 	—      |

3) Подключиться по SSH с локальной машины и скопировать логин/пароль для подключения к AirFlow через web-интерфейс

		ssh dima@51.250.23.122

4) Переконфигурируем AirFlow, внеся изменения в /etc/airflow/airflow.cfg (чтобы выводилось меньше ненужной информации, напр. примеры DAG'ов)

		sudo nano /etc/airflow/airflow.cfg

	load_examples = False
	load_default_connections = False

	Сохраняем изменения и перезапускаем виртуальную машину

5) Создаем новый DAG

		cd /home/airflow/dags/
		sudo nano mks.py

	Копируем содержимое mks.py из репозитория MLOps/airflow_example/ в только что созданный mks.py и сохраняем изменения

6) Подключиться к AirFlow через web-интерфейс

		http://51.250.23.122:80/

	Здесь должны увидеть новый DAG с dag_id = mks_geo

7) Запускаем переключателем DAG. Через некоторое время можем увидеть выполненные экземпляры DAG'a, в логах будут храниться результаты запросов к сервису.

8) Заменив PythonOperator, например, на PostgresOperator можем сохранять результаты запросов в базу данных.